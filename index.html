<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API Test Suite Huy·ªÅn L√™</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css"
        rel="stylesheet" />
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            --danger-gradient: linear-gradient(45deg, #ff6b6b 0%, #ee5a52 100%);
        }

        body {
            background: var(--primary-gradient);
            min-height: 100vh;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        }

        .main-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin: 20px auto;
            max-width: 1400px;
        }

        .header-section {
            background: var(--success-gradient);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header-section::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle,
                    rgba(255, 255, 255, 0.1) 0%,
                    transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .header-section h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header-section p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
            margin: 0;
        }

        .controls-section {
            background: #f8fafc;
            padding: 30px;
            border-bottom: 1px solid #e2e8f0;
        }

        .btn-gradient {
            background: var(--primary-gradient);
            border: none;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
            color: white;
        }

        .btn-success-gradient {
            background: var(--success-gradient);
            border: none;
            color: white;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
        }

        .btn-success-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 172, 254, 0.6);
            color: white;
        }

        .btn-danger-gradient {
            background: var(--danger-gradient);
            border: none;
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .btn-danger-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
            color: white;
        }

        .test-item {
            background: white;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: all 0.3s ease;
            border-left: 5px solid #667eea;
        }

        .test-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }

        .test-item.group-a {
            border-left-color: #4facfe;
            background: linear-gradient(135deg,
                    rgba(79, 172, 254, 0.02) 0%,
                    rgba(0, 242, 254, 0.02) 100%);
        }

        .test-item.group-b {
            border-left-color: #ff6b6b;
            background: linear-gradient(135deg,
                    rgba(255, 107, 107, 0.02) 0%,
                    rgba(238, 90, 82, 0.02) 100%);
        }

        .test-header {
            padding: 20px;
            background: rgba(102, 126, 234, 0.05);
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
        }

        .method-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .method-get {
            background: #48bb78;
            color: white;
        }

        .method-post {
            background: #4299e1;
            color: white;
        }

        .method-put {
            background: #ed8936;
            color: white;
        }

        .method-delete {
            background: #f56565;
            color: white;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-success {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-error {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-pending {
            background: #feebc8;
            color: #7b341e;
        }

        .status-processing {
            background: #bee3f8;
            color: #2c5aa0;
        }

        .test-details {
            padding: 20px;
        }

        .detail-section {
            background: #f8fafc;
            padding: 16px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            margin-bottom: 15px;
        }

        .detail-title {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-content {
            font-family: "Courier New", monospace;
            font-size: 13px;
            color: #2d3748;
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            text-align: center;
            padding: 20px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #718096;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .comparison-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #4a5568;
            border-top: none;
        }

        .response-cell {
            max-width: 300px;
            word-break: break-all;
            font-family: "Courier New", monospace;
            font-size: 12px;
        }

        .same-response {
            background: #c6f6d5;
            color: #22543d;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }

        .different-response {
            background: #fed7d7;
            color: #742a2a;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .storage-item {
            cursor: pointer;
            transition: background 0.2s ease;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #e2e8f0;
        }

        .storage-item:hover {
            background: #f7fafc;
        }

        .storage-date {
            font-size: 12px;
            color: #718096;
        }

        .storage-stats {
            font-size: 12px;
            color: #4a5568;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="main-container">
            <!-- Header -->
            <div class="header-section">
                <h1><i class="bi bi-rocket"></i> API Test Huyen Le</h1>
                <img src="https://cdn.airvoicewireless.com/default/1113303/hl.png" class="img-thumbnail"
                    style="width: 100px; height: 100px; object-fit: contain" />
            </div>

            <!-- Controls -->
            <div class="controls-section">
                <div class="row g-3 mb-3">
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="groupName"
                            placeholder="T√™n nh√≥m test (VD: Login API)" value="API Test" />
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="keyName"
                            placeholder="Key ƒë·ªÉ so s√°nh (VD: user-login)" />
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-success-gradient" onclick="addNewTest()">
                            <i class="bi bi-plus-circle"></i> Th√™m Test M·ªõi
                        </button>
                    </div>
                </div>

                <div class="row g-2 mb-3">
                    <div class="col-auto">
                        <button class="btn btn-gradient" onclick="selectTestsModal()">
                            <i class="bi bi-check2-square"></i> Ch·ªçn & Ch·∫°y
                        </button>
                    </div>
                    <div class="col-auto">
                        <button class="btn btn-gradient" onclick="processAllTests()">
                            <span id="processBtn"><i class="bi bi-lightning"></i> Ch·∫°y T·∫•t C·∫£</span>
                        </button>
                    </div>
                    <div class="col-auto">
                        <button class="btn btn-info" onclick="showComparisonModal()">
                            <i class="bi bi-bar-chart"></i> So S√°nh
                        </button>
                    </div>
                    <div class="col-auto">
                        <button class="btn btn-warning" onclick="exportToCSV()">
                            <i class="bi bi-file-earmark-spreadsheet"></i> Export CSV
                        </button>
                    </div>
                    <div class="col-auto">
                        <button class="btn btn-secondary" onclick="showStorageModal()">
                            <i class="bi bi-archive"></i> L∆∞u Tr·ªØ
                        </button>
                    </div>
                    <div class="col-auto">
                        <button class="btn btn-danger-gradient" onclick="clearAllTests()">
                            <i class="bi bi-trash"></i> X√≥a T·∫•t C·∫£
                        </button>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <textarea id="curlInput" class="form-control" rows="4"
                            placeholder="Paste CURL command ·ªü ƒë√¢y...
V√≠ d·ª•: curl --location --request GET 'https://api.example.com/users' --header 'Authorization: Bearer token123'"></textarea>
                    </div>
                </div>
            </div>

            <!-- Stats -->
            <div class="container-fluid p-4">
                <div class="row g-3 mb-4">
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number" id="totalTests">0</div>
                            <div class="stat-label">T·ªïng Tests</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number" id="successTests">0</div>
                            <div class="stat-label">Th√†nh C√¥ng</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number" id="errorTests">0</div>
                            <div class="stat-label">L·ªói</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number" id="pendingTests">0</div>
                            <div class="stat-label">Ch·ªù X·ª≠ L√Ω</div>
                        </div>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="progress mb-4" style="height: 6px">
                    <div class="progress-bar bg-success" id="progressBar" role="progressbar" style="width: 0%"></div>
                </div>

                <!-- Tests Container -->
                <div id="testsContainer">
                    <div class="text-center py-5">
                        <i class="bi bi-clipboard-data" style="font-size: 4rem; color: #718096"></i>
                        <h3 class="mt-3 text-muted">Ch∆∞a c√≥ test n√†o</h3>
                        <p class="text-muted">Th√™m CURL command ƒë·∫ßu ti√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Select Tests Modal -->
    <div class="modal fade" id="selectTestsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-check2-square"></i> Ch·ªçn Tests ƒë·ªÉ Ch·∫°y
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <button class="btn btn-outline-primary btn-sm me-2" onclick="selectAllTests()">
                            <i class="bi bi-check-all"></i> Ch·ªçn T·∫•t C·∫£
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="deselectAllTests()">
                            <i class="bi bi-x-square"></i> B·ªè Ch·ªçn T·∫•t C·∫£
                        </button>
                    </div>
                    <div id="testSelectionList" class="border rounded p-3" style="max-height: 400px; overflow-y: auto">
                        <!-- Test selection items will be populated here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        ƒê√≥ng
                    </button>
                    <button type="button" class="btn btn-success" onclick="processSelectedTests()">
                        <i class="bi bi-play-circle"></i> Ch·∫°y Tests ƒê√£ Ch·ªçn
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Comparison Modal -->
    <div class="modal fade" id="comparisonModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-bar-chart"></i> B·∫£ng So S√°nh API Tests
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: 80vh; overflow-y: auto">
                    <div id="comparisonContent">
                        <!-- Comparison content will be populated here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        ƒê√≥ng
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Storage Modal -->
    <div class="modal fade" id="storageModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-secondary text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-archive"></i> Qu·∫£n L√Ω D·ªØ Li·ªáu
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>L∆∞u √Ω:</strong> D·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u trong localStorage c·ªßa
                        tr√¨nh duy·ªát.
                    </div>

                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-success" onclick="saveCurrentData()">
                            <i class="bi bi-floppy"></i> L∆∞u D·ªØ Li·ªáu Hi·ªán T·∫°i
                        </button>
                        <button class="btn btn-outline-danger" onclick="clearAllStorage()">
                            <i class="bi bi-trash"></i> X√≥a T·∫•t C·∫£ L∆∞u Tr·ªØ
                        </button>
                    </div>

                    <h6><i class="bi bi-folder"></i> D·ªØ Li·ªáu ƒê√£ L∆∞u:</h6>
                    <div id="storageList" style="max-height: 400px; overflow-y: auto">
                        <!-- Storage items will be populated here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        ƒê√≥ng
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <script>
        // Global variables
        let testData = [];
        let currentId = 1;

        // Utility functions
        function safeJsonParse(str) {
            try {
                return JSON.parse(str);
            } catch (e) {
                return null;
            }
        }

        function deepDiff(obj1, obj2) {
            if (typeof obj1 !== typeof obj2) return { from: obj1, to: obj2 };
            if (typeof obj1 !== "object" || obj1 === null || obj2 === null) {
                return obj1 === obj2 ? null : { from: obj1, to: obj2 };
            }

            const diff = {};
            const keys = new Set([
                ...Object.keys(obj1 || {}),
                ...Object.keys(obj2 || {}),
            ]);
            for (const key of keys) {
                const d = deepDiff(obj1[key], obj2[key]);
                if (d) diff[key] = d;
            }
            return Object.keys(diff).length > 0 ? diff : null;
        }

        function diffText(a, b) {
            if (!a || !b) return "N/A";
            const aLines = a.split("\n");
            const bLines = b.split("\n");
            for (let i = 0; i < Math.min(aLines.length, bLines.length); i++) {
                if (aLines[i] !== bLines[i]) {
                    return `Line ${i + 1}:\n- ${aLines[i]}\n+ ${bLines[i]}`;
                }
            }
            if (aLines.length !== bLines.length) {
                return `Different number of lines (${aLines.length} vs ${bLines.length})`;
            }
            return "‚úÖ No difference";
        }

        function diffTextDeep(a, b) {
            try {
                const objA = safeJsonParse(a);
                const objB = safeJsonParse(b);
                if (!objA || !objB) throw new Error("Invalid JSON");
                const diff = deepDiff(objA, objB);
                return diff ? JSON.stringify(diff, null, 2) : "‚úÖ No difference";
            } catch (_) {
                return diffText(a, b);
            }
        }

        function parseCurl(curlCommand) {
            let method = "GET";
            let url = "";
            let headers = {};
            let payload = "";

            try {
                // METHOD
                const methodMatch = curlCommand.match(/--request\s+(\w+)/i);
                if (methodMatch) method = methodMatch[1].toUpperCase();

                // URL
                const urlMatch = curlCommand.match(
                    /(?:--url|--location(?:\s+--request\s+\w+)?)\s*['"]?(https?:\/\/[^\s'"]+)['"]?/i
                );
                if (urlMatch) url = urlMatch[1];

                // HEADERS
                const headerRegex = /--header\s+'([^:]+):\s*(.+?)'/g;
                let headerMatch;
                while ((headerMatch = headerRegex.exec(curlCommand)) !== null) {
                    headers[headerMatch[1].trim()] = headerMatch[2].trim();
                }

                // PAYLOAD
                const payloadMatch = curlCommand.match(
                    /--data(?:-raw)?\s+'([\s\S]+?)'/
                );
                if (payloadMatch) payload = payloadMatch[1];

                return { method, url, headers, payload };
            } catch (e) {
                throw new Error("Kh√¥ng th·ªÉ parse CURL command: " + e.message);
            }
        }

        async function makeApiCall(method, url, headers, payload) {
            const options = {
                method,
                headers: {
                    "Content-Type": "application/json",
                    ...headers,
                },
            };

            if (["POST", "PUT", "PATCH"].includes(method) && payload) {
                options.body = payload;
            }

            const response = await fetch(url, options);
            const responseText = await response.text();

            return {
                status: response.status,
                statusText: response.statusText,
                headers: Object.fromEntries(response.headers.entries()),
                body: responseText,
                ok: response.ok,
            };
        }

        // Test management functions
        function addNewTest() {
            const groupName = document.getElementById("groupName").value.trim();
            const keyName = document.getElementById("keyName").value.trim();
            const curlCommand = document.getElementById("curlInput").value.trim();

            if (!curlCommand) {
                alert("Vui l√≤ng nh·∫≠p CURL command!");
                return;
            }

            if (!keyName) {
                alert("Vui l√≤ng nh·∫≠p Key ƒë·ªÉ so s√°nh!");
                return;
            }

            try {
                const parsed = parseCurl(curlCommand);
                const test = {
                    id: currentId++,
                    group: groupName || "Default",
                    key: keyName,
                    curlRaw: curlCommand,
                    method: parsed.method,
                    url: parsed.url,
                    headers: parsed.headers,
                    payload: parsed.payload,
                    response: null,
                    status: "pending",
                    diff: null,
                    timestamp: new Date().toISOString(),
                    selected: false,
                };

                testData.push(test);
                document.getElementById("curlInput").value = "";
                document.getElementById("keyName").value = "";
                updateUI();
            } catch (e) {
                alert("L·ªói parse CURL: " + e.message);
            }
        }

        async function processTest(testId) {
            const test = testData.find((t) => t.id === testId);
            if (!test) return;

            test.status = "processing";
            updateTestItem(test);

            try {
                const response = await makeApiCall(
                    test.method,
                    test.url,
                    test.headers,
                    test.payload
                );
                test.response = response;
                test.status = response.ok ? "success" : "error";

                // Calculate diff with previous test with same key
                const sameKeyTests = testData.filter(
                    (t) => t.key === test.key && t.id < test.id && t.response
                );
                if (sameKeyTests.length > 0) {
                    const prevTest = sameKeyTests[sameKeyTests.length - 1];
                    test.diff = diffTextDeep(
                        prevTest.response.body,
                        test.response.body
                    );
                }
            } catch (e) {
                test.response = { error: e.message };
                test.status = "error";
            }

            updateTestItem(test);
            updateStats();
        }

        async function processAllTests() {
            const pendingTests = testData.filter((t) => t.status === "pending");
            if (pendingTests.length === 0) {
                alert("Kh√¥ng c√≥ test n√†o ƒë·ªÉ x·ª≠ l√Ω!");
                return;
            }

            await processTests(pendingTests);
        }

        async function processSelectedTests() {
            const selectedTests = testData.filter(
                (t) => t.selected && t.status === "pending"
            );
            if (selectedTests.length === 0) {
                alert("Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt test ƒë·ªÉ ch·∫°y!");
                return;
            }

            bootstrap.Modal.getInstance(
                document.getElementById("selectTestsModal")
            ).hide();
            await processTests(selectedTests);
        }

        async function processTests(tests) {
            const processBtn = document.getElementById("processBtn");
            const originalText = processBtn.innerHTML;
            processBtn.innerHTML =
                '<span class="loading-spinner"></span> ƒêang x·ª≠ l√Ω...';

            let completed = 0;
            const total = tests.length;

            for (const test of tests) {
                await processTest(test.id);
                completed++;
                updateProgress((completed / total) * 100);
                await new Promise((resolve) => setTimeout(resolve, 100));
            }

            processBtn.innerHTML = originalText;
            updateProgress(0);
        }

        function clearAllTests() {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ tests?")) {
                testData = [];
                currentId = 1;
                updateUI();
            }
        }

        // UI update functions
        function updateProgress(percent) {
            document.getElementById("progressBar").style.width = percent + "%";
        }

        function updateStats() {
            const total = testData.length;
            const success = testData.filter((t) => t.status === "success").length;
            const error = testData.filter((t) => t.status === "error").length;
            const pending = testData.filter((t) => t.status === "pending").length;

            document.getElementById("totalTests").textContent = total;
            document.getElementById("successTests").textContent = success;
            document.getElementById("errorTests").textContent = error;
            document.getElementById("pendingTests").textContent = pending;
        }

        function updateTestItem(test) {
            const element = document.getElementById(`test-${test.id}`);
            if (element) {
                element.outerHTML = createTestItemHTML(test);
            }
        }

        function createTestItemHTML(test) {
            const groupClass = test.group.toLowerCase().includes("a")
                ? "group-a"
                : "group-b";
            const methodClass = `method-${test.method.toLowerCase()}`;
            const statusClass = `status-${test.status}`;
            const statusText = {
                pending: '<i class="bi bi-clock"></i> Ch·ªù x·ª≠ l√Ω',
                processing: '<i class="bi bi-arrow-repeat"></i> ƒêang x·ª≠ l√Ω...',
                success: '<i class="bi bi-check-circle"></i> Th√†nh c√¥ng',
                error: '<i class="bi bi-x-circle"></i> L·ªói',
            };

            return `
                <div class="test-item ${groupClass}" id="test-${test.id}">
                    <div class="test-header" data-bs-toggle="collapse" data-bs-target="#details-${test.id
                }">
                        <div class="d-flex justify-content-between align-items-center">
                                                            <div class="d-flex align-items-center gap-2">
                                <span class="method-badge ${methodClass}">${test.method
                }</span>
                                <span><i class="bi bi-key"></i> ${test.key} | ${test.group
                }</span>
                                <small class="text-muted">${test.url}</small>
                            </div>
                            <span class="status-badge ${statusClass}">${statusText[test.status]
                }</span>
                        </div>
                    </div>
                    <div class="collapse" id="details-${test.id}">
                        <div class="test-details">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="detail-section">
                                        <div class="detail-title">Key</div>
                                        <div class="detail-content">${test.key
                }</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="detail-section">
                                        <div class="detail-title">Group</div>
                                        <div class="detail-content">${test.group
                }</div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="detail-section">
                                        <div class="detail-title">CURL Command</div>
                                        <div class="detail-content">${test.curlRaw
                }</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="detail-section">
                                        <div class="detail-title">Headers</div>
                                        <div class="detail-content">${JSON.stringify(
                    test.headers,
                    null,
                    2
                )}</div>
                                    </div>
                                </div>
                                ${test.payload
                    ? `
                                <div class="col-md-6">
                                    <div class="detail-section">
                                        <div class="detail-title">Payload</div>
                                        <div class="detail-content">${test.payload}</div>
                                    </div>
                                </div>
                                `
                    : ""
                }
                                ${test.response
                    ? `
                                <div class="col-12">
                                    <div class="detail-section">
                                        <div class="detail-title">Response</div>
                                        <div class="detail-content">${test.response.error ||
                    JSON.stringify(test.response, null, 2)
                    }</div>
                                    </div>
                                </div>
                                `
                    : ""
                }
                                ${test.diff
                    ? `
                                <div class="col-12">
                                    <div class="detail-section">
                                        <div class="detail-title">Diff v·ªõi test tr∆∞·ªõc (c√πng key)</div>
                                        <div class="detail-content">${test.diff}</div>
                                    </div>
                                </div>
                                `
                    : ""
                }
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateUI() {
            const container = document.getElementById("testsContainer");

            if (testData.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-clipboard-data" style="font-size: 4rem; color: #718096;"></i>
                        <h3 class="mt-3 text-muted">Ch∆∞a c√≥ test n√†o</h3>
                        <p class="text-muted">Th√™m CURL command ƒë·∫ßu ti√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu!</p>
                    </div>
                `;
            } else {
                container.innerHTML = testData
                    .map((test) => createTestItemHTML(test))
                    .join("");
            }

            updateStats();
        }

        // Modal functions
        function selectTestsModal() {
            if (testData.length === 0) {
                alert("Ch∆∞a c√≥ test n√†o ƒë·ªÉ ch·ªçn!");
                return;
            }

            const list = document.getElementById("testSelectionList");
            let html = "";

            testData.forEach((test) => {
                const statusIcon = {
                    pending: "bi-clock text-warning",
                    processing: "bi-arrow-repeat text-info",
                    success: "bi-check-circle text-success",
                    error: "bi-x-circle text-danger",
                };

                html += `
                    <div class="form-check mb-2 p-2 border rounded">
                        <input class="form-check-input" type="checkbox" id="test-select-${test.id
                    }" 
                               ${test.selected ? "checked" : ""} 
                               onchange="toggleTestSelection(${test.id})">
                        <label class="form-check-label w-100" for="test-select-${test.id
                    }">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="method-badge method-${test.method.toLowerCase()}">${test.method
                    }</span>
                                    <strong>${test.key}</strong> - ${test.group}
                                    <br><small class="text-muted">${test.url
                    }</small>
                                </div>
                                <i class="bi ${statusIcon[test.status]}"></i>
                            </div>
                        </label>
                    </div>
                `;
            });

            list.innerHTML = html;
            new bootstrap.Modal(document.getElementById("selectTestsModal")).show();
        }

        function toggleTestSelection(testId) {
            const test = testData.find((t) => t.id === testId);
            if (test) {
                test.selected = document.getElementById(
                    `test-select-${testId}`
                ).checked;
            }
        }

        function selectAllTests() {
            testData.forEach((test) => {
                test.selected = true;
                const checkbox = document.getElementById(`test-select-${test.id}`);
                if (checkbox) checkbox.checked = true;
            });
        }

        function deselectAllTests() {
            testData.forEach((test) => {
                test.selected = false;
                const checkbox = document.getElementById(`test-select-${test.id}`);
                if (checkbox) checkbox.checked = false;
            });
        }

        // Comparison modal
        // Deep comparison function ƒë·ªÉ so s√°nh object/array ƒë·ªá quy
        function deepCompare(obj1, obj2) {
            if (obj1 === obj2) return true;

            if (obj1 == null || obj2 == null) return obj1 === obj2;

            if (typeof obj1 !== typeof obj2) return false;

            if (typeof obj1 !== "object") return obj1 === obj2;

            if (Array.isArray(obj1) !== Array.isArray(obj2)) return false;

            const keys1 = Object.keys(obj1);
            const keys2 = Object.keys(obj2);

            if (keys1.length !== keys2.length) return false;

            for (let key of keys1) {
                if (!keys2.includes(key)) return false;
                if (!deepCompare(obj1[key], obj2[key])) return false;
            }

            return true;
        }

        // Function ƒë·ªÉ t√¨m differences gi·ªØa 2 object
        function findDifferences(obj1, obj2, path = "") {
            const differences = [];

            if (obj1 === obj2) return differences;

            if (typeof obj1 !== typeof obj2) {
                differences.push({
                    path: path || "root",
                    type: "type_change",
                    old: typeof obj1,
                    new: typeof obj2,
                    oldValue: obj1,
                    newValue: obj2,
                });
                return differences;
            }

            if (typeof obj1 !== "object" || obj1 == null || obj2 == null) {
                if (obj1 !== obj2) {
                    differences.push({
                        path: path || "root",
                        type: "value_change",
                        old: obj1,
                        new: obj2,
                    });
                }
                return differences;
            }

            const allKeys = new Set([...Object.keys(obj1), ...Object.keys(obj2)]);

            for (let key of allKeys) {
                const newPath = path ? `${path}.${key}` : key;

                if (!(key in obj1)) {
                    differences.push({
                        path: newPath,
                        type: "added",
                        new: obj2[key],
                    });
                } else if (!(key in obj2)) {
                    differences.push({
                        path: newPath,
                        type: "removed",
                        old: obj1[key],
                    });
                } else {
                    differences.push(...findDifferences(obj1[key], obj2[key], newPath));
                }
            }

            return differences;
        }

        // Function ƒë·ªÉ parse response body th√†nh object n·∫øu c√≥ th·ªÉ
        function parseResponseBody(body) {
            if (!body) return body;

            try {
                return JSON.parse(body);
            } catch (e) {
                return body;
            }
        }

        // Deep comparison function ƒë·ªÉ so s√°nh object/array ƒë·ªá quy
        function deepCompare(obj1, obj2) {
            if (obj1 === obj2) return true;

            if (obj1 == null || obj2 == null) return obj1 === obj2;

            if (typeof obj1 !== typeof obj2) return false;

            if (typeof obj1 !== "object") return obj1 === obj2;

            if (Array.isArray(obj1) !== Array.isArray(obj2)) return false;

            const keys1 = Object.keys(obj1);
            const keys2 = Object.keys(obj2);

            if (keys1.length !== keys2.length) return false;

            for (let key of keys1) {
                if (!keys2.includes(key)) return false;
                if (!deepCompare(obj1[key], obj2[key])) return false;
            }

            return true;
        }

        // Function ƒë·ªÉ t√¨m differences gi·ªØa 2 object
        function findDifferences(obj1, obj2, path = "") {
            const differences = [];

            if (obj1 === obj2) return differences;

            if (typeof obj1 !== typeof obj2) {
                differences.push({
                    path: path || "root",
                    type: "type_change",
                    old: typeof obj1,
                    new: typeof obj2,
                    oldValue: obj1,
                    newValue: obj2,
                });
                return differences;
            }

            if (typeof obj1 !== "object" || obj1 == null || obj2 == null) {
                if (obj1 !== obj2) {
                    differences.push({
                        path: path || "root",
                        type: "value_change",
                        old: obj1,
                        new: obj2,
                    });
                }
                return differences;
            }

            const allKeys = new Set([...Object.keys(obj1), ...Object.keys(obj2)]);

            for (let key of allKeys) {
                const newPath = path ? `${path}.${key}` : key;

                if (!(key in obj1)) {
                    differences.push({
                        path: newPath,
                        type: "added",
                        new: obj2[key],
                    });
                } else if (!(key in obj2)) {
                    differences.push({
                        path: newPath,
                        type: "removed",
                        old: obj1[key],
                    });
                } else {
                    differences.push(...findDifferences(obj1[key], obj2[key], newPath));
                }
            }

            return differences;
        }

        // Function ƒë·ªÉ parse response body th√†nh object n·∫øu c√≥ th·ªÉ
        function parseResponseBody(body) {
            if (!body) return body;

            try {
                return JSON.parse(body);
            } catch (e) {
                return body;
            }
        }

        // Function ƒë·ªÉ format differences cho display
        function formatDifferences(differences) {
            if (differences.length === 0)
                return '<span class="text-success">‚úÖ Ho√†n to√†n gi·ªëng nhau</span>';

            let html = '<div class="differences-list">';
            differences.forEach((diff) => {
                let icon, color, text;

                switch (diff.type) {
                    case "added":
                        icon = "‚ûï";
                        color = "success";
                        text = `Th√™m: ${diff.path} = ${JSON.stringify(diff.new)}`;
                        break;
                    case "removed":
                        icon = "‚ûñ";
                        color = "danger";
                        text = `X√≥a: ${diff.path} = ${JSON.stringify(diff.old)}`;
                        break;
                    case "value_change":
                        icon = "üîÑ";
                        color = "warning";
                        text = `Thay ƒë·ªïi: ${diff.path} t·ª´ ${JSON.stringify(
                            diff.old
                        )} th√†nh ${JSON.stringify(diff.new)}`;
                        break;
                    case "type_change":
                        icon = "üîÄ";
                        color = "info";
                        text = `Thay ƒë·ªïi ki·ªÉu: ${diff.path} t·ª´ ${diff.old} th√†nh ${diff.new}`;
                        break;
                }

                html += `<div class="text-${color} small">${icon} ${text}</div>`;
            });
            html += "</div>";

            return html;
        }

        function showComparisonModal() {
            if (testData.length === 0) {
                alert("Ch∆∞a c√≥ test n√†o ƒë·ªÉ so s√°nh!");
                return;
            }

            const content = document.getElementById("comparisonContent");

            // Group tests by key
            const testsByKey = {};
            testData.forEach((test) => {
                if (!testsByKey[test.key]) {
                    testsByKey[test.key] = [];
                }
                testsByKey[test.key].push(test);
            });

            let html = "";

            // T·∫°o b·∫£ng t·ªïng quan so s√°nh keys gi·ªëng nhau
            const keyComparison = Object.keys(testsByKey).map((key) => {
                const tests = testsByKey[key];
                const completedTests = tests.filter(
                    (t) => t.status === "success" && t.response
                );

                if (completedTests.length < 2) {
                    return {
                        key,
                        status: "insufficient_data",
                        message: `Ch·ªâ c√≥ ${completedTests.length} test ho√†n th√†nh`,
                        count: tests.length,
                    };
                }

                // So s√°nh t·∫•t c·∫£ responses v·ªõi nhau
                let allSame = true;
                const firstResponse = parseResponseBody(
                    completedTests[0].response.body
                );

                for (let i = 1; i < completedTests.length; i++) {
                    const currentResponse = parseResponseBody(
                        completedTests[i].response.body
                    );
                    if (!deepCompare(firstResponse, currentResponse)) {
                        allSame = false;
                        break;
                    }
                }

                return {
                    key,
                    status: allSame ? "identical" : "different",
                    message: allSame
                        ? "T·∫•t c·∫£ response gi·ªëng nhau"
                        : "Response c√≥ kh√°c bi·ªát",
                    count: tests.length,
                    completedCount: completedTests.length,
                };
            });

            // B·∫£ng t·ªïng quan
            html += `
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-bar-chart"></i> T·ªïng quan so s√°nh Keys</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Key</th>
                                <th>T·ªïng s·ªë test</th>
                                <th>Test ho√†n th√†nh</th>
                                <th>Tr·∫°ng th√°i so s√°nh</th>
                                <th>Th√¥ng tin</th>
                            </tr>
                        </thead>
                        <tbody>
    `;

            keyComparison.forEach((comp) => {
                let statusBadge, statusIcon;

                switch (comp.status) {
                    case "identical":
                        statusBadge = "bg-success";
                        statusIcon = "‚úÖ";
                        break;
                    case "different":
                        statusBadge = "bg-warning";
                        statusIcon = "‚ö†Ô∏è";
                        break;
                    case "insufficient_data":
                        statusBadge = "bg-secondary";
                        statusIcon = "‚ùì";
                        break;
                }

                html += `
            <tr>
                <td><strong>${comp.key}</strong></td>
                <td>${comp.count}</td>
                <td>${comp.completedCount || 0}</td>
                <td><span class="badge ${statusBadge}">${statusIcon} ${comp.status
                    }</span></td>
                <td>${comp.message}</td>
            </tr>
        `;
            });

            html += `
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    `;

            // Chi ti·∫øt t·ª´ng key
            Object.keys(testsByKey).forEach((key) => {
                const tests = testsByKey[key];
                html += `
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="bi bi-key"></i> Key: ${key} (${tests.length} tests)</h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-sm comparison-table mb-0">
                            <thead>
                                <tr>
                                    <th>Group</th>
                                    <th>Method</th>
                                    <th>URL</th>
                                    <th>Status</th>
                                    <th>Response Preview</th>
                                    <th>Timestamp</th>
                                    <th>Text So s√°nh</th>
                                    <th>Key So s√°nh</th>
                                </tr>
                            </thead>
                            <tbody>
        `;

                tests.forEach((test, index) => {
                    const statusIcon = {
                        pending: '<i class="bi bi-clock text-warning"></i>',
                        processing: '<i class="bi bi-arrow-repeat text-info"></i>',
                        success: '<i class="bi bi-check-circle text-success"></i>',
                        error: '<i class="bi bi-x-circle text-danger"></i>',
                    };

                    let responsePreview = "N/A";
                    if (test.response) {
                        if (test.response.error) {
                            responsePreview = `‚ùå ${test.response.error}`;
                        } else {
                            const body = test.response.body;
                            responsePreview =
                                body.length > 100 ? body.substring(0, 100) + "..." : body;
                        }
                    }

                    // So s√°nh text v√† key v·ªõi test tr∆∞·ªõc
                    let textCompare = "N/A";
                    let keyCompare = "N/A";

                    if (
                        index > 0 &&
                        test.response &&
                        tests[index - 1].response &&
                        test.status === "success" &&
                        tests[index - 1].status === "success"
                    ) {
                        const prevResponseText = tests[index - 1].response.body;
                        const currentResponseText = test.response.body;

                        // So s√°nh text thu·∫ßn t√∫y
                        if (prevResponseText === currentResponseText) {
                            textCompare =
                                '<span class="badge bg-success">‚úÖ Gi·ªëng nhau</span>';
                        } else {
                            textCompare =
                                '<span class="badge bg-warning">‚ö†Ô∏è Kh√°c nhau</span>';
                        }

                        // So s√°nh keys c·ªßa object
                        const prevResponse = parseResponseBody(prevResponseText);
                        const currentResponse = parseResponseBody(currentResponseText);

                        if (
                            typeof prevResponse === "object" &&
                            typeof currentResponse === "object" &&
                            prevResponse !== null &&
                            currentResponse !== null
                        ) {
                            const prevKeys = Object.keys(prevResponse).sort();
                            const currentKeys = Object.keys(currentResponse).sort();

                            if (JSON.stringify(prevKeys) === JSON.stringify(currentKeys)) {
                                keyCompare =
                                    '<span class="badge bg-success">‚úÖ Keys gi·ªëng nhau</span>';
                            } else {
                                keyCompare =
                                    '<span class="badge bg-warning">‚ö†Ô∏è Keys kh√°c nhau</span>';
                            }
                        } else {
                            keyCompare =
                                '<span class="badge bg-secondary">‚ùì Kh√¥ng ph·∫£i object</span>';
                        }
                    }

                    html += `
                <tr>
                    <td><strong>${test.group}</strong></td>
                    <td><span class="badge method-${test.method.toLowerCase()}">${test.method
                        }</span></td>
                    <td class="response-cell">${test.url}</td>
                    <td>${statusIcon[test.status]} ${test.status}</td>
                    <td class="response-cell">${responsePreview}</td>
                    <td><small>${new Date(test.timestamp).toLocaleString(
                            "vi-VN"
                        )}</small></td>
                    <td>${textCompare}</td>
                    <td>${keyCompare}</td>
                </tr>
            `;
                });

                html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        `;
            });

            if (html === "") {
                html =
                    '<div class="text-center py-4"><h5>Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ so s√°nh</h5></div>';
            }

            content.innerHTML = html;
            new bootstrap.Modal(document.getElementById("comparisonModal")).show();
        }

        // Export functions
        function exportToCSV() {
            if (testData.length === 0) {
                alert("Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ export!");
                return;
            }

            const headers = [
                "Key",
                "Group",
                "Method",
                "URL",
                "Status",
                "Response",
                "Timestamp",
            ];
            let csvContent = headers.join(",") + "\n";

            testData.forEach((test) => {
                const row = [
                    `"${test.key}"`,
                    `"${test.group}"`,
                    `"${test.method}"`,
                    `"${test.url}"`,
                    `"${test.status}"`,
                    `"${test.response
                        ? test.response.error ||
                        JSON.stringify(test.response.body).replace(/"/g, '""')
                        : "N/A"
                    }"`,
                    `"${new Date(test.timestamp).toLocaleString("vi-VN")}"`,
                ];
                csvContent += row.join(",") + "\n";
            });

            const blob = new Blob(["\ufeff" + csvContent], {
                type: "text/csv;charset=utf-8;",
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `api-test-report-${new Date()
                .toISOString()
                .slice(0, 19)
                .replace(/:/g, "-")}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Storage functions
        function showStorageModal() {
            loadStorageList();
            new bootstrap.Modal(document.getElementById("storageModal")).show();
        }

        function saveCurrentData() {
            if (testData.length === 0) {
                alert("Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ l∆∞u!");
                return;
            }

            const now = new Date();
            const dateStr = now.toISOString().slice(0, 19).replace(/:/g, "-");
            const key = `test_${dateStr}`;

            const dataToSave = {
                timestamp: now.toISOString(),
                data: testData,
                stats: {
                    total: testData.length,
                    success: testData.filter((t) => t.status === "success").length,
                    error: testData.filter((t) => t.status === "error").length,
                    pending: testData.filter((t) => t.status === "pending").length,
                },
            };

            try {
                localStorage.setItem(key, JSON.stringify(dataToSave));
                loadStorageList();
                alert("‚úÖ ƒê√£ l∆∞u d·ªØ li·ªáu th√†nh c√¥ng!");
            } catch (error) {
                alert("‚ùå L·ªói khi l∆∞u d·ªØ li·ªáu: " + error.message);
            }
        }

        function loadStorageList() {
            const list = document.getElementById("storageList");
            const keys = [];

            // Get all test keys from localStorage
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith("test_")) {
                    keys.push(key);
                }
            }

            keys.sort().reverse(); // Newest first

            if (keys.length === 0) {
                list.innerHTML =
                    '<div class="text-center py-4 text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu n√†o ƒë∆∞·ª£c l∆∞u</div>';
                return;
            }

            let html = "";
            keys.forEach((key) => {
                try {
                    const data = JSON.parse(localStorage.getItem(key));
                    const date = new Date(data.timestamp);
                    html += `
                        <div class="storage-item" onclick="loadStorageData('${key}')">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <div><strong><i class="bi bi-archive"></i> ${key}</strong></div>
                                    <div class="storage-date">${date.toLocaleString(
                        "vi-VN"
                    )}</div>
                                    <div class="storage-stats">
                                        <i class="bi bi-bar-chart"></i> ${data.stats.total
                        } tests | 
                                        <span class="text-success">‚úÖ ${data.stats.success
                        }</span> | 
                                        <span class="text-danger">‚ùå ${data.stats.error
                        }</span>
                                    </div>
                                </div>
                                <button class="btn btn-outline-danger btn-sm" 
                                        onclick="event.stopPropagation(); deleteStorageData('${key}')">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                } catch (error) {
                    console.error("Error parsing stored data:", error);
                }
            });

            list.innerHTML = html;
        }

        function loadStorageData(key) {
            if (
                confirm(
                    "T·∫£i d·ªØ li·ªáu n√†y s·∫Ω thay th·∫ø d·ªØ li·ªáu hi·ªán t·∫°i. B·∫°n c√≥ ch·∫Øc ch·∫Øn?"
                )
            ) {
                try {
                    const data = JSON.parse(localStorage.getItem(key));
                    testData = data.data;
                    currentId = Math.max(...testData.map((t) => t.id)) + 1;
                    updateUI();
                    bootstrap.Modal.getInstance(
                        document.getElementById("storageModal")
                    ).hide();
                    alert("‚úÖ ƒê√£ t·∫£i d·ªØ li·ªáu th√†nh c√¥ng!");
                } catch (error) {
                    alert("‚ùå L·ªói khi t·∫£i d·ªØ li·ªáu: " + error.message);
                }
            }
        }

        function deleteStorageData(key) {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a d·ªØ li·ªáu n√†y?")) {
                localStorage.removeItem(key);
                loadStorageList();
            }
        }

        function clearAllStorage() {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ d·ªØ li·ªáu ƒë√£ l∆∞u?")) {
                const keysToDelete = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith("test_")) {
                        keysToDelete.push(key);
                    }
                }
                keysToDelete.forEach((key) => localStorage.removeItem(key));
                loadStorageList();
                alert("‚úÖ ƒê√£ x√≥a t·∫•t c·∫£ d·ªØ li·ªáu l∆∞u tr·ªØ!");
            }
        }

        // Event listeners
        document
            .getElementById("curlInput")
            .addEventListener("keydown", function (e) {
                if (e.ctrlKey && e.key === "Enter") {
                    addNewTest();
                }
            });

        // Initialize
        updateUI();
    </script>
</body>

</html>